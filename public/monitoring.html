<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gol de Ouro - Monitoramento em Tempo Real</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy { background-color: #27ae60; }
        .status-warning { background-color: #f39c12; }
        .status-critical { background-color: #e74c3c; }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 10px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .alerts-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .alert-item {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-critical {
            background-color: #fdf2f2;
            border-left-color: #e74c3c;
            color: #c0392b;
        }

        .alert-warning {
            background-color: #fef9e7;
            border-left-color: #f39c12;
            color: #d68910;
        }

        .logs-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .log-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-info { background-color: #e8f4fd; color: #2980b9; }
        .log-warn { background-color: #fef9e7; color: #d68910; }
        .log-error { background-color: #fdf2f2; color: #c0392b; }
        .log-debug { background-color: #f4f4f4; color: #7f8c8d; }

        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .uptime {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 10px;
        }

        .error-message {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Gol de Ouro - Monitoramento</h1>
            <div class="uptime">
                √öltima atualiza√ß√£o: <span id="lastUpdate">--</span> | 
                Uptime: <span id="uptime">--</span>
            </div>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;">
            Erro ao carregar dados de monitoramento. Tentando novamente...
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h3>Status do Sistema</h3>
                <div class="metric-value">
                    <span id="systemStatus" class="status-indicator"></span>
                    <span id="systemStatusText">--</span>
                </div>
                <div class="metric-label">Estado atual</div>
            </div>

            <div class="metric-card">
                <h3>Usu√°rios Ativos</h3>
                <div class="metric-value" id="activeUsers">--</div>
                <div class="metric-label">Conectados agora</div>
            </div>

            <div class="metric-card">
                <h3>Jogos Ativos</h3>
                <div class="metric-value" id="activeGames">--</div>
                <div class="metric-label">Em andamento</div>
            </div>

            <div class="metric-card">
                <h3>CPU</h3>
                <div class="metric-value" id="cpuUsage">--%</div>
                <div class="metric-label">Uso atual</div>
            </div>

            <div class="metric-card">
                <h3>Mem√≥ria</h3>
                <div class="metric-value" id="memoryUsage">--%</div>
                <div class="metric-label">Uso atual</div>
            </div>

            <div class="metric-card">
                <h3>Taxa de Erro</h3>
                <div class="metric-value" id="errorRate">--%</div>
                <div class="metric-label">√öltimos 5 minutos</div>
            </div>

            <div class="metric-card">
                <h3>Receita Total</h3>
                <div class="metric-value" id="totalRevenue">R$ --</div>
                <div class="metric-label">Hoje</div>
            </div>

            <div class="metric-card">
                <h3>Taxa de Convers√£o</h3>
                <div class="metric-value" id="conversionRate">--%</div>
                <div class="metric-label">Usu√°rios ‚Üí Apostas</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>M√©tricas em Tempo Real</h3>
            <canvas id="metricsChart" width="400" height="200"></canvas>
        </div>

        <div class="alerts-container">
            <h3>Alertas Ativos</h3>
            <div id="alertsList">
                <p>Carregando alertas...</p>
            </div>
        </div>

        <div class="logs-container">
            <h3>Logs Recentes</h3>
            <div id="logsList">
                <p>Carregando logs...</p>
            </div>
        </div>
    </div>

    <div class="refresh-indicator" id="refreshIndicator">
        <div class="spinner"></div>
    </div>

    <script>
        let metricsChart;
        let chartData = {
            labels: [],
            datasets: [{
                label: 'CPU %',
                data: [],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.4
            }, {
                label: 'Mem√≥ria %',
                data: [],
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                tension: 0.4
            }]
        };

        // Inicializar gr√°fico
        function initChart() {
            const ctx = document.getElementById('metricsChart').getContext('2d');
            metricsChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // Atualizar dados
        async function updateData() {
            const refreshIndicator = document.getElementById('refreshIndicator');
            refreshIndicator.style.display = 'block';

            try {
                const response = await fetch('/api/monitoring/realtime');
                const result = await response.json();

                if (result.success) {
                    updateMetrics(result.data);
                    updateAlerts(result.data.alerts);
                    updateChart(result.data);
                    document.getElementById('errorMessage').style.display = 'none';
                } else {
                    throw new Error(result.message || 'Erro ao obter dados');
                }
            } catch (error) {
                console.error('Erro ao atualizar dados:', error);
                document.getElementById('errorMessage').style.display = 'block';
            } finally {
                refreshIndicator.style.display = 'none';
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            }
        }

        // Atualizar m√©tricas
        function updateMetrics(data) {
            // Status do sistema
            const statusElement = document.getElementById('systemStatus');
            const statusText = document.getElementById('systemStatusText');
            statusElement.className = `status-indicator status-${data.system.status}`;
            statusText.textContent = data.system.status.toUpperCase();

            // M√©tricas
            document.getElementById('activeUsers').textContent = data.application.activeUsers;
            document.getElementById('activeGames').textContent = data.application.activeGames;
            document.getElementById('cpuUsage').textContent = data.system.cpu + '%';
            document.getElementById('memoryUsage').textContent = data.system.memory + '%';
            document.getElementById('errorRate').textContent = data.application.errorRate + '%';
            document.getElementById('totalRevenue').textContent = 'R$ ' + data.business.totalRevenue.toFixed(2);
            document.getElementById('conversionRate').textContent = data.business.conversionRate.toFixed(1) + '%';

            // Uptime
            const uptimeSeconds = data.system.uptime;
            const hours = Math.floor(uptimeSeconds / 3600);
            const minutes = Math.floor((uptimeSeconds % 3600) / 60);
            document.getElementById('uptime').textContent = `${hours}h ${minutes}m`;
        }

        // Atualizar alertas
        function updateAlerts(alerts) {
            const alertsList = document.getElementById('alertsList');
            
            if (alerts.count === 0) {
                alertsList.innerHTML = '<p style="color: #27ae60;">‚úÖ Nenhum alerta ativo</p>';
                return;
            }

            let html = '';
            alerts.recent.forEach(alert => {
                const timeAgo = alert.timeAgo < 60 ? `${alert.timeAgo}s` : 
                               alert.timeAgo < 3600 ? `${Math.floor(alert.timeAgo / 60)}m` :
                               `${Math.floor(alert.timeAgo / 3600)}h`;
                
                html += `
                    <div class="alert-item alert-${alert.severity}">
                        <strong>${alert.type.replace(/_/g, ' ').toUpperCase()}</strong><br>
                        ${alert.message}<br>
                        <small>${timeAgo} atr√°s</small>
                    </div>
                `;
            });

            alertsList.innerHTML = html;
        }

        // Atualizar gr√°fico
        function updateChart(data) {
            const now = new Date().toLocaleTimeString();
            
            // Adicionar novos dados
            chartData.labels.push(now);
            chartData.datasets[0].data.push(data.system.cpu);
            chartData.datasets[1].data.push(data.system.memory);

            // Manter apenas os √∫ltimos 20 pontos
            if (chartData.labels.length > 20) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
                chartData.datasets[1].data.shift();
            }

            metricsChart.update('none');
        }

        // Carregar logs
        async function loadLogs() {
            try {
                const response = await fetch('/api/monitoring/logs?level=all&limit=20');
                const result = await response.json();

                if (result.success) {
                    updateLogs(result.data.logs);
                }
            } catch (error) {
                console.error('Erro ao carregar logs:', error);
            }
        }

        // Atualizar logs
        function updateLogs(logs) {
            const logsList = document.getElementById('logsList');
            
            let html = '';
            logs.forEach(log => {
                const time = new Date(log.timestamp).toLocaleTimeString();
                html += `
                    <div class="log-item log-${log.level}">
                        [${time}] [${log.level.toUpperCase()}] ${log.message}
                    </div>
                `;
            });

            logsList.innerHTML = html;
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            updateData();
            loadLogs();
            
            // Atualizar a cada 5 segundos
            setInterval(updateData, 5000);
            
            // Atualizar logs a cada 30 segundos
            setInterval(loadLogs, 30000);
        });
    </script>
</body>
</html>
