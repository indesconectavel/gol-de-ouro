<!doctype html>
<html lang="pt-BR">
  <head>
    <!-- ‚úÖ KILL SWITCH INLINE - Remove Service Workers antigos ANTES de qualquer coisa -->
    <!-- CR√çTICO: Inline para n√£o ser interceptado pelo Service Worker antigo -->
    <script>
      (function() {
        'use strict';
        
        // ‚úÖ CORRE√á√ÉO CR√çTICA: Detectar se est√° usando bundle antigo e for√ßar atualiza√ß√£o
        // Este c√≥digo funciona mesmo se o HTML antigo estiver sendo servido
        const currentScript = document.currentScript || (function() {
          const scripts = document.getElementsByTagName('script');
          return scripts[scripts.length - 1];
        })();
        
        // ‚úÖ CORRE√á√ÉO CR√çTICA: Detectar bundle antigo IMEDIATAMENTE e for√ßar atualiza√ß√£o
        // Verificar ANTES de qualquer c√≥digo executar
        (function checkBundleImmediately() {
          const moduleScripts = document.querySelectorAll('script[type="module"][src*="index-"]');
          let hasOldBundle = false;
          
          moduleScripts.forEach(function(script) {
            const src = script.src || script.getAttribute('src') || '';
            // Verificar se √© bundle ANTIGO (DOXRH9LH ou qualquer outro antigo conhecido)
            if (src.includes('index-DOXRH9LH.js') || 
                src.includes('index-B74THvjy.js') || 
                src.includes('index-BVaTwX4C.js') ||
                src.includes('index-BK79O84G.js') ||
                src.includes('index-Bvz1uanR.js') ||
                src.includes('index-Duj1CNUZ.js') ||
                src.includes('index-DtPXGL4e.js') ||
                src.includes('index-sPoNFTTD.js') ||
                src.includes('index-Hh8aXNzV.js')) {
              hasOldBundle = true;
              console.error('[KILL-SW-INLINE] ‚ùå BUNDLE ANTIGO DETECTADO:', src);
            }
          });
          
          // Se h√° bundle antigo, for√ßar limpeza IMEDIATA
          if (hasOldBundle && !window.__REDIRECTING_TO_KILL_SW__) {
            window.__REDIRECTING_TO_KILL_SW__ = true;
            console.error('[KILL-SW-INLINE] üö® REDIRECIONANDO PARA KILL-SW POR BUNDLE ANTIGO');
            console.error('[KILL-SW-INLINE] Bundle antigo detectado:', Array.from(moduleScripts).map(s => s.src || s.getAttribute('src')).join(', '));
            
            // Limpar tudo ANTES de redirecionar
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(function(regs) {
                console.log('[KILL-SW-INLINE] Encontrados', regs.length, 'Service Workers para desregistrar');
                regs.forEach(function(reg) { 
                  console.log('[KILL-SW-INLINE] Desregistrando SW antigo:', reg.scope);
                  reg.unregister(); 
                });
                if ('caches' in window) {
                  caches.keys().then(function(names) {
                    console.log('[KILL-SW-INLINE] Encontrados', names.length, 'caches para deletar');
                    names.forEach(function(name) { 
                      console.log('[KILL-SW-INLINE] Deletando cache:', name);
                      caches.delete(name); 
                    });
                    // Redirecionar para kill-sw.html
                    console.log('[KILL-SW-INLINE] Redirecionando para /kill-sw.html');
                    window.location.replace('/kill-sw.html?reason=bundle-antigo&t=' + Date.now());
                  });
                } else {
                  window.location.replace('/kill-sw.html?reason=bundle-antigo&t=' + Date.now());
                }
              });
            } else {
              window.location.replace('/kill-sw.html?reason=bundle-antigo&t=' + Date.now());
            }
            return; // N√£o continuar execu√ß√£o
          }
          
          // Verificar novamente ap√≥s 500ms para garantir
          setTimeout(function() {
            const scripts = document.querySelectorAll('script[type="module"][src*="index-"]');
            let stillOld = false;
            scripts.forEach(function(script) {
              const src = script.src || script.getAttribute('src') || '';
              if (src.includes('index-DOXRH9LH.js') || 
                  src.includes('index-B74THvjy.js') || 
                  src.includes('index-BVaTwX4C.js') ||
                  src.includes('index-BK79O84G.js') ||
                  src.includes('index-Bvz1uanR.js') ||
                  src.includes('index-Duj1CNUZ.js') ||
                  src.includes('index-DtPXGL4e.js') ||
                  src.includes('index-sPoNFTTD.js') ||
                  src.includes('index-Hh8aXNzV.js')) {
                stillOld = true;
              }
            });
            
            if (stillOld) {
              console.error('[KILL-SW-INLINE] üö® BUNDLE ANTIGO AINDA PRESENTE AP√ìS 500ms');
              window.location.replace('/kill-sw.html?reason=bundle-antigo-delayed');
            }
          }, 500);
        })();
        
        console.log('[KILL-SW-INLINE] Iniciando remo√ß√£o for√ßada de Service Workers antigos...');
        
        if ('serviceWorker' in navigator) {
          // Desregistrar TODOS os Service Workers IMEDIATAMENTE
          navigator.serviceWorker.getRegistrations().then(function(registrations) {
            console.log('[KILL-SW-INLINE] Encontrados', registrations.length, 'Service Workers');
            
            registrations.forEach(function(registration) {
              console.log('[KILL-SW-INLINE] Desregistrando:', registration.scope);
              registration.unregister().then(function(success) {
                if (success) {
                  console.log('[KILL-SW-INLINE] ‚úÖ Service Worker desregistrado:', registration.scope);
                } else {
                  console.warn('[KILL-SW-INLINE] ‚ö†Ô∏è Falha ao desregistrar:', registration.scope);
                }
              });
            });
            
            // Limpar TODOS os caches IMEDIATAMENTE
            if (caches && caches.keys) {
              caches.keys().then(function(cacheNames) {
                console.log('[KILL-SW-INLINE] Encontrados', cacheNames.length, 'caches');
                
                cacheNames.forEach(function(cacheName) {
                  console.log('[KILL-SW-INLINE] Deletando cache:', cacheName);
                  caches.delete(cacheName).then(function(success) {
                    if (success) {
                      console.log('[KILL-SW-INLINE] ‚úÖ Cache deletado:', cacheName);
                    }
                  });
                });
              });
            }
            
            // Limpar sessionStorage e localStorage
            try {
              sessionStorage.clear();
              localStorage.removeItem('sw-registered');
              localStorage.removeItem('sw-version');
              
              // ‚úÖ CORRE√á√ÉO: S√≥ for√ßar backend de produ√ß√£o se N√ÉO estiver em localhost
              const isProduction = typeof window !== 'undefined' && (
                window.location.hostname.includes('goldeouro.lol') ||
                window.location.hostname.includes('goldeouro.com') ||
                window.location.hostname === 'www.goldeouro.lol' ||
                window.location.hostname === 'goldeouro.lol'
              );
              
              if (isProduction) {
                localStorage.removeItem('API_BASE_URL');
                sessionStorage.setItem('API_BASE_URL', 'https://goldeouro-backend-v2.fly.dev');
                localStorage.setItem('API_BASE_URL', 'https://goldeouro-backend-v2.fly.dev');
                console.log('[KILL-SW-INLINE] ‚úÖ Storage limpo e backend for√ßado (PRODU√á√ÉO)');
              } else {
                console.log('[KILL-SW-INLINE] ‚úÖ Storage limpo (DESENVOLVIMENTO - usando proxy)');
              }
            } catch (e) {
              console.warn('[KILL-SW-INLINE] ‚ö†Ô∏è Erro ao limpar storage:', e);
            }
          });
        }
        
        // ‚úÖ CORRE√á√ÉO: S√≥ for√ßar backend de produ√ß√£o se N√ÉO estiver em localhost
        if (typeof window !== 'undefined') {
          const isProduction = (
            window.location.hostname.includes('goldeouro.lol') ||
            window.location.hostname.includes('goldeouro.com') ||
            window.location.hostname === 'www.goldeouro.lol' ||
            window.location.hostname === 'goldeouro.lol'
          );
          
          if (isProduction) {
            window.__API_BASE_URL__ = 'https://goldeouro-backend-v2.fly.dev';
            window.__FORCED_BACKEND__ = true;
            window.__BOOTSTRAP_EXECUTED__ = true;
            console.log('[KILL-SW-INLINE] ‚úÖ Backend for√ßado (PRODU√á√ÉO):', window.__API_BASE_URL__);
          } else {
            console.log('[KILL-SW-INLINE] ‚úÖ Modo desenvolvimento - usando proxy do Vite');
          }
        }
      })();
    </script>
    <!-- ‚úÖ SW KILL GLOBAL - Script que SEMPRE √© servido da rede (n√£o do cache) -->
    <!-- CR√çTICO: Este script NUNCA est√° no precache do SW antigo -->
    <script src="/sw-kill-global.js?v=20250124130200"></script>
    <!-- ‚úÖ FORCE UPDATE - Script que SEMPRE √© servido da rede (n√£o do cache) -->
    <script src="/force-update.js?v=20250124130000"></script>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CSP REMOVIDO PARA DESENVOLVIMENTO E MVP -->
    <meta name="theme-color" content="#ffd700" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="cache-bust" content="2025-01-12-19-30">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Gol de Ouro - Jogador</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
